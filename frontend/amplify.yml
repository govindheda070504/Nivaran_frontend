version: 1
frontend:
  appRoot: "."
  framework: "Next.js - SSR"

  phases:
    preBuild:
      commands:
        - "echo 'Installing dependencies...' && pwd && ls -la"
        - "if [ -f package-lock.json ]; then npm ci; else npm install; fi"
        - "echo 'Dependencies installed successfully'"
    build:
      commands:
        - "echo 'Building Next.js application...' && npm run build"
        - "echo 'Build completed successfully'"

  artifacts:
    baseDirectory: .next
    files:
      - "**/*"

  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*

  env:
    variables:
      NODE_ENV: production
      NEXT_PUBLIC_GOOGLE_MAPS_API_KEY: $NEXT_PUBLIC_GOOGLE_MAPS_API_KEY
      NEXT_PUBLIC_BACKEND_API: $NEXT_PUBLIC_BACKEND_API
      NEXT_PUBLIC_S3_BUCKET: $NEXT_PUBLIC_S3_BUCKET
      NEXT_PUBLIC_AWS_REGION: $NEXT_PUBLIC_AWS_REGION
      NEXT_PUBLIC_FIREBASE_API_KEY: $NEXT_PUBLIC_FIREBASE_API_KEY
      NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN: $NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
      NEXT_PUBLIC_FIREBASE_PROJECT_ID: $NEXT_PUBLIC_FIREBASE_PROJECT_ID
      NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET: $NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
      NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID: $NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
      NEXT_PUBLIC_FIREBASE_APP_ID: $NEXT_PUBLIC_FIREBASE_APP_ID